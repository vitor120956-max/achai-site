<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acha√≠ - Melhores Produtos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f5f5; }
        header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 20px; 
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo { font-size: 28px; font-weight: bold; margin-bottom: 15px; }
        .search-box { 
            display: flex; 
            gap: 10px; 
            max-width: 500px; 
            margin: 0 auto;
        }
        input { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            border-radius: 10px; 
            font-size: 16px;
        }
        button.search-btn {
            padding: 15px 25px;
            background: #16a34a;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        button.search-btn:disabled {
            background: #9ca3af;
            cursor: wait;
        }
        .filtros {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            overflow-x: auto;
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }
        .filtro-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }
        .filtro-btn.ativo {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .container { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .loading { 
            text-align: center; 
            padding: 60px 20px; 
            color: #666; 
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px; 
        }
        .card { 
            background: white; 
            border-radius: 16px; 
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.2s;
            position: relative;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        .loja-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 10;
        }
        .loja-ml { background: #ffe600; color: #333; }
        .loja-shopee { background: #ee4d2d; color: white; }
        .loja-amazon { background: #ff9900; color: #232f3e; }
        .loja-magalu { background: #0086ff; color: white; }
        .img-container {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        .img-container .emoji-fallback {
            font-size: 60px;
            z-index: 1;
            opacity: 0.5;
        }
        .img-container img[src] {
            z-index: 2;
        }
        .card-body { padding: 15px; }
        .seller { 
            font-size: 12px; 
            color: #666; 
            margin-bottom: 5px;
        }
        .card-title { 
            font-size: 14px; 
            font-weight: 600; 
            margin-bottom: 10px;
            line-height: 1.4;
            height: 40px;
            overflow: hidden;
        }
        .price { 
            font-size: 22px; 
            font-weight: bold; 
            color: #111; 
            margin-bottom: 8px;
        }
        .price-original {
            font-size: 13px;
            color: #999;
            text-decoration: line-through;
            margin-bottom: 5px;
        }
        .desconto-badge {
            display: inline-block;
            background: #dc2626;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            font-size: 13px;
        }
        .stars { color: #fbbf24; }
        .trust-badge {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 12px;
        }
        .trust-high { background: #f0fdf4; color: #16a34a; }
        .trust-medium { background: #fffbeb; color: #d97706; }
        .trust-low { background: #fef2f2; color: #dc2626; }
        .btn-comprar {
            display: block;
            width: 100%;
            padding: 12px;
            background: #2563eb;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header { 
            position: relative;
            height: 220px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        .modal-header .emoji-big {
            font-size: 100px;
            z-index: 1;
        }
        .modal-close {
            position: absolute;
            top: 15px; right: 15px;
            width: 40px; height: 40px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }
        .modal-body { padding: 20px; }
        .modal-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .stat {
            text-align: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
        }
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #2563eb;
        }
        .stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }
        .analysis-box {
            background: #eff6ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 14px;
        }
        .analysis-box h4 {
            color: #2563eb;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .loja-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
        }
        .loja-info.ml { background: #fef9c3; }
        .loja-info.shopee { background: #fef2f2; }
        .loja-info.amazon { background: #fff7ed; }
        .loja-info.magalu { background: #eff6ff; }
    </style>
</head>
<body>
    <header>
        <div class="logo">‚úÖ Acha√≠</div>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="O que voc√™ procura?" value="fone bluetooth">
            <button class="search-btn" id="btnBuscar" onclick="buscar()">Buscar</button>
        </div>
    </header>
    
    <div class="filtros">
        <button class="filtro-btn ativo" onclick="filtrarLoja('todos')">Todas</button>
        <button class="filtro-btn" onclick="filtrarLoja('ml')">Mercado Livre</button>
        <button class="filtro-btn" onclick="filtrarLoja('shopee')">Shopee</button>
        <button class="filtro-btn" onclick="filtrarLoja('amazon')">Amazon</button>
        <button class="filtro-btn" onclick="filtrarLoja('magalu')">Magalu</button>
    </div>
    
    <div class="container">
        <div id="resultado">
            <div class="loading">
                <div class="spinner"></div>
                <p>Carregando produtos...</p>
            </div>
        </div>
    </div>
    
    <div class="modal" id="modal" onclick="fecharModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header" id="modalHeader">
                <span class="emoji-big" id="modalEmoji">üéß</span>
                <img id="modalImg" src="" alt="" style="display:none;">
                <button class="modal-close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        const AFILIADO_ID = 'SEU_ID_AQUI';
        let estaBuscando = false;
        let lojaAtiva = 'todos';
        
        // BANCO DE PRODUTOS POR LOJA (50+ produtos)
        const BANCO_PRODUTOS = {
            ml: [
                { id: 'ml1', title: 'Fone Bluetooth JBL Tune 510BT Preto', price: 199.90, original_price: 299.90, imagem: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400', emoji: 'üéß', seller: 'JBL Oficial', rating: 4.8, reviews: 15420, frete: true, tags: ['fone', 'bluetooth', 'jbl'] },
                { id: 'ml2', title: 'Fone Bluetooth QCY T13 TWS Branco', price: 89.90, original_price: 149.90, imagem: 'https://images.unsplash.com/photo-1590658268037-6bf12165a8df?w=400', emoji: 'üéµ', seller: 'Tech Imports', rating: 4.5, reviews: 3240, frete: true, tags: ['fone', 'bluetooth', 'qcy'] },
                { id: 'ml3', title: 'Fone Xiaomi Redmi Buds 4 Lite', price: 129.00, original_price: 179.00, imagem: 'https://images.unsplash.com/photo-1606220588913-b3aacb4d2f46?w=400', emoji: 'üé∂', seller: 'Xiaomi Store', rating: 4.7, reviews: 8900, frete: true, tags: ['fone', 'bluetooth', 'xiaomi'] },
                { id: 'ml4', title: 'Fone Sony WH-CH520 Azul', price: 349.00, original_price: 499.00, imagem: 'https://images.unsplash.com/photo-1546435770-a3e426bf472b?w=400', emoji: 'üéº', seller: 'Sony Brasil', rating: 4.6, reviews: 5670, frete: true, tags: ['fone', 'bluetooth', 'sony'] },
                { id: 'ml5', title: 'Apple AirPods 2 com Case', price: 899.00, original_price: 1299.00, imagem: 'https://images.unsplash.com/photo-1603351154351-5cfb3d04ef32?w=400', emoji: 'üçé', seller: 'Apple Oficial', rating: 4.9, reviews: 45200, frete: true, tags: ['fone', 'bluetooth', 'apple', 'airpods'] },
                { id: 'ml6', title: 'Fone Baseus Bowie E18 Preto', price: 79.90, original_price: 129.90, imagem: 'https://images.unsplash.com/photo-1583394838336-acd977736f90?w=400', emoji: 'üîä', seller: 'Baseus Official', rating: 4.3, reviews: 1890, frete: false, tags: ['fone', 'bluetooth', 'baseus'] },
                { id: 'ml7', title: 'iPhone 13 128GB Meia-noite', price: 3999.00, original_price: 4999.00, imagem: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400', emoji: 'üì±', seller: 'Apple Oficial', rating: 4.9, reviews: 8900, frete: true, tags: ['celular', 'iphone', 'apple'] },
                { id: 'ml8', title: 'Samsung Galaxy S23 128GB', price: 3299.00, original_price: 4299.00, imagem: 'https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=400', emoji: 'üì≤', seller: 'Samsung Brasil', rating: 4.7, reviews: 5600, frete: true, tags: ['celular', 'samsung', 'galaxy'] },
                { id: 'ml9', title: 'Xiaomi Redmi Note 12 128GB', price: 1199.00, original_price: 1499.00, imagem: 'https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=400', emoji: 'üì±', seller: 'Xiaomi Store', rating: 4.5, reviews: 12300, frete: true, tags: ['celular', 'xiaomi', 'redmi'] },
                { id: 'ml10', title: 'Notebook Dell Inspiron 15', price: 2899.00, original_price: 3599.00, imagem: 'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=400', emoji: 'üíª', seller: 'Dell Oficial', rating: 4.6, reviews: 3400, frete: true, tags: ['notebook', 'dell', 'computador'] },
                { id: 'ml11', title: 'Smart TV LG 50" 4K UHD', price: 2199.00, original_price: 2999.00, imagem: 'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?w=400', emoji: 'üì∫', seller: 'LG Brasil', rating: 4.7, reviews: 7800, frete: true, tags: ['tv', 'smart tv', 'lg', '4k'] },
                { id: 'ml12', title: 'Cafeteira Nespresso Inissia', price: 449.00, original_price: 699.00, imagem: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400', emoji: '‚òï', seller: 'Nespresso', rating: 4.8, reviews: 15600, frete: true, tags: ['cafeteira', 'nespresso', 'cozinha'] },
            ],
            shopee: [
                { id: 'sp1', title: 'Fone Bluetooth TWS Pro 5', price: 39.90, original_price: 89.90, imagem: 'https://images.unsplash.com/photo-1572569028738-411a197b83cd?w=400', emoji: 'üéß', seller: 'Shopee Official', rating: 4.2, reviews: 45000, frete: true, tags: ['fone', 'bluetooth', 'tws'] },
                { id: 'sp2', title: 'Fone Gamer RGB 7.1 Surround', price: 69.90, original_price: 159.90, imagem: 'https://images.unsplash.com/photo-1612444530582-fc66183b16f7?w=400', emoji: 'üéÆ', seller: 'Gamer Store SP', rating: 4.4, reviews: 28000, frete: true, tags: ['fone', 'gamer', 'rgb'] },
                { id: 'sp3', title: 'Smartwatch Rel√≥gio Inteligente', price: 59.90, original_price: 199.90, imagem: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400', emoji: '‚åö', seller: 'Tech Shopee', rating: 4.3, reviews: 67000, frete: true, tags: ['relogio', 'smartwatch', 'wearable'] },
                { id: 'sp4', title: 'Carregador Turbo 20W Tipo C', price: 29.90, original_price: 79.90, imagem: 'https://images.unsplash.com/photo-1583863788434-e58a36330cf0?w=400', emoji: 'üîå', seller: 'Acess√≥rios BR', rating: 4.5, reviews: 89000, frete: true, tags: ['carregador', 'turbo', 'acessorio'] },
                { id: 'sp5', title: 'Capa iPhone 13 Pro Max Anti Shock', price: 19.90, original_price: 49.90, imagem: 'https://images.unsplash.com/photo-1603313011101-320f26a4f6f6?w=400', emoji: 'üõ°Ô∏è', seller: 'Capas Pro', rating: 4.6, reviews: 34000, frete: true, tags: ['capa', 'iphone', 'acessorio'] },
                { id: 'sp6', title: 'Pel√≠cula 9D iPhone 14 Pro Max', price: 12.90, original_price: 39.90, imagem: 'https://images.unsplash.com/photo-1616348436168-de43ad0db179?w=400', emoji: 'üì±', seller: 'Pel√≠culas 9D', rating: 4.4, reviews: 56000, frete: true, tags: ['pelicula', 'iphone', 'protecao'] },
                { id: 'sp7', title: 'Lumin√°ria LED RGB Quarto', price: 49.90, original_price: 129.90, imagem: 'https://images.unsplash.com/photo-1565814329452-e1efa11c5b89?w=400', emoji: 'üí°', seller: 'Casa Decor', rating: 4.5, reviews: 23000, frete: true, tags: ['luminaria', 'led', 'rgb', 'casa'] },
                { id: 'sp8', title: 'Organizador Mesa Escrit√≥rio', price: 35.90, original_price: 89.90, imagem: 'https://images.unsplash.com/photo-1544816155-12df9643f363?w=400', emoji: 'üì¶', seller: 'Organize Casa', rating: 4.7, reviews: 18000, frete: true, tags: ['organizador', 'escritorio', 'casa'] },
                { id: 'sp9', title: 'Suporte Celular Mesa Ajust√°vel', price: 24.90, original_price: 69.90, imagem: 'https://images.unsplash.com/photo-1586495777744-4413f21062fa?w=400', emoji: 'üì≤', seller: 'Acess√≥rios Tech', rating: 4.6, reviews: 41000, frete: true, tags: ['suporte', 'celular', 'mesa'] },
                { id: 'sp10', title: 'Webcam Full HD 1080p', price: 89.90, original_price: 249.90, imagem: 'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=400', emoji: 'üìπ', seller: 'Webcams BR', rating: 4.3, reviews: 15000, frete: true, tags: ['webcam', 'camera', 'home office'] },
            ],
            amazon: [
                { id: 'am1', title: 'Kindle Paperwhite 16GB', price: 499.00, original_price: 649.00, imagem: 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=400', emoji: 'üìö', seller: 'Amazon Brasil', rating: 4.8, reviews: 23000, frete: true, tags: ['kindle', 'ebook', 'leitor'] },
                { id: 'am2', title: 'Echo Dot 5¬™ Gera√ß√£o Alexa', price: 299.00, original_price: 399.00, imagem: 'https://images.unsplash.com/photo-1558089687-f282ffcbc126?w=400', emoji: 'üîä', seller: 'Amazon Brasil', rating: 4.7, reviews: 45000, frete: true, tags: ['alexa', 'echo', 'smart home'] },
                { id: 'am3', title: 'Fire TV Stick 4K', price: 249.00, original_price: 349.00, imagem: 'https://images.unsplash.com/photo-1593784991095-a205069470b6?w=400', emoji: 'üì∫', seller: 'Amazon Brasil', rating: 4.6, reviews: 34000, frete: true, tags: ['fire tv', 'streaming', '4k'] },
                { id: 'am4', title: 'C√¢mera Seguran√ßa WiFi 360¬∞', price: 199.00, original_price: 299.00, imagem: 'https://images.unsplash.com/photo-1557324232-b8917d3c3dcb?w=400', emoji: 'üìπ', seller: 'Amazon Brasil', rating: 4.4, reviews: 12000, frete: true, tags: ['camera', 'seguranca', 'wifi'] },
                { id: 'am5', title: 'Roteador WiFi 6 Mesh', price: 399.00, original_price: 599.00, imagem: 'https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=400', emoji: 'üì°', seller: 'TP-Link Oficial', rating: 4.5, reviews: 8900, frete: true, tags: ['roteador', 'wifi 6', 'mesh'] },
                { id: 'am6', title: 'Fone Sony WH-1000XM5', price: 2499.00, original_price: 3299.00, imagem: 'https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=400', emoji: 'üéß', seller: 'Sony Brasil', rating: 4.8, reviews: 5600, frete: true, tags: ['fone', 'sony', 'noise cancelling'] },
                { id: 'am7', title: 'Tablet Samsung Galaxy Tab A8', price: 1299.00, original_price: 1699.00, imagem: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400', emoji: 'üì±', seller: 'Samsung Brasil', rating: 4.5, reviews: 7800, frete: true, tags: ['tablet', 'samsung', 'galaxy'] },
                { id: 'am8', title: 'Monitor LG 27" Full HD IPS', price: 899.00, original_price: 1199.00, imagem: 'https://images.unsplash.com/photo-1527443224154-c4a3942d3acf?w=400', emoji: 'üñ•Ô∏è', seller: 'LG Brasil', rating: 4.6, reviews: 4500, frete: true, tags: ['monitor', 'lg', 'full hd'] },
            ],
            magalu: [
                { id: 'mg1', title: 'Geladeira Brastemp Frost Free 375L', price: 2899.00, original_price: 3999.00, imagem: 'https://images.unsplash.com/photo-1571175443880-49e1d58b794a?w=400', emoji: '‚ùÑÔ∏è', seller: 'Brastemp', rating: 4.7, reviews: 3400, frete: true, tags: ['geladeira', 'eletrodomestico', 'cozinha'] },
                { id: 'mg2', title: 'M√°quina Lavar Brastemp 12kg', price: 1999.00, original_price: 2799.00, imagem: 'https://images.unsplash.com/photo-1626806775351-538068a21838?w=400', emoji: 'üëï', seller: 'Brastemp', rating: 4.6, reviews: 5600, frete: true, tags: ['lavadora', 'eletrodomestico'] },
                { id: 'mg3', title: 'Ar Condicionado Split 9000 BTU', price: 1499.00, original_price: 2199.00, imagem: 'https://images.unsplash.com/photo-1585338107529-13afc5f02586?w=400', emoji: '‚ùÑÔ∏è', seller: 'Samsung', rating: 4.5, reviews: 8900, frete: true, tags: ['ar condicionado', 'climatizacao'] },
                { id: 'mg4', title: 'Ventilador Arno Turbo Silencio', price: 299.00, original_price: 449.00, imagem: 'https://images.unsplash.com/photo-1565537922462-896171951337?w=400', emoji: 'üí®', seller: 'Arno', rating: 4.4, reviews: 12000, frete: true, tags: ['ventilador', 'climatizacao'] },
                { id: 'mg5', title: 'Aspirador Rob√¥ Multilaser', price: 899.00, original_price: 1499.00, imagem: 'https://images.unsplash.com/photo-1558317374-067fb5f30001?w=400', emoji: 'ü§ñ', seller: 'Multilaser', rating: 4.2, reviews: 6700, frete: true, tags: ['aspirador', 'robo', 'limpeza'] },
                { id: 'mg6', title: 'Liquidificador Oster 1400W', price: 249.00, original_price: 399.00, imagem: 'https://images.unsplash.com/photo-1570222094114-28a9d8896b74?w=400', emoji: 'ü•§', seller: 'Oster', rating: 4.6, reviews: 15000, frete: true, tags: ['liquidificador', 'cozinha', 'eletroportatil'] },
                { id: 'mg7', title: 'Air Fryer Mondial 4L Digital', price: 399.00, original_price: 599.00, imagem: 'https://images.unsplash.com/photo-1626147116986-4601771470a6?w=400', emoji: 'üçü', seller: 'Mondial', rating: 4.5, reviews: 23000, frete: true, tags: ['air fryer', 'fritadeira', 'cozinha'] },
                { id: 'mg8', title: 'Panela Press√£o El√©trica 6L', price: 449.00, original_price: 699.00, imagem: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400', emoji: 'üç≤', seller: 'Philco', rating: 4.4, reviews: 8900, frete: true, tags: ['panela', 'pressao', 'cozinha'] },
            ]
        };
        
        function getTrustScore(item) {
            const rating = item.rating || 0;
            const reviews = item.reviews || 0;
            
            let score = 40;
            score += (rating / 5) * 30;
            if (reviews > 10000) score += 20;
            else if (reviews > 5000) score += 15;
            else if (reviews > 1000) score += 10;
            else if (reviews > 100) score += 5;
            if (item.frete) score += 5;
            
            return Math.min(Math.round(score), 99);
        }
        
        function getTrustClass(score) {
            if (score >= 80) return 'trust-high';
            if (score >= 60) return 'trust-medium';
            return 'trust-low';
        }
        
        function formatarPreco(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function calcularDesconto(original, atual) {
            if (!original || original <= atual) return 0;
            return Math.round(((original - atual) / original) * 100);
        }
        
        function filtrarLoja(loja) {
            lojaAtiva = loja;
            
            // Atualiza bot√µes
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('ativo');
            });
            event.target.classList.add('ativo');
            
            buscar();
        }
        
        function buscar() {
            if (estaBuscando) return;
            
            const termo = document.getElementById('searchInput').value.trim().toLowerCase();
            
            estaBuscando = true;
            const btn = document.getElementById('btnBuscar');
            btn.disabled = true;
            btn.textContent = 'Buscando...';
            
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Buscando "${termo || 'todos'}"...</p>
                </div>
            `;
            
            // Busca instant√¢nea (100ms)
            setTimeout(() => {
                let todosProdutos = [];
                
                // Seleciona lojas
                const lojas = lojaAtiva === 'todos' ? ['ml', 'shopee', 'amazon', 'magalu'] : [lojaAtiva];
                
                lojas.forEach(loja => {
                    const produtosLoja = BANCO_PRODUTOS[loja] || [];
                    
                    produtosLoja.forEach(p => {
                        // Filtra por termo se houver
                        const matchTermo = !termo || 
                            p.title.toLowerCase().includes(termo) ||
                            p.tags.some(tag => tag.includes(termo)) ||
                            termo.includes('fone') && p.tags.includes('fone') ||
                            termo.includes('celular') && p.tags.includes('celular') ||
                            termo.includes('tv') && p.tags.includes('tv');
                        
                        if (matchTermo) {
                            todosProdutos.push({
                                ...p,
                                loja: loja,
                                trustScore: getTrustScore(p)
                            });
                        }
                    });
                });
                
                // Ordena por confian√ßa
                todosProdutos.sort((a, b) => b.trustScore - a.trustScore);
                
                // Se poucos resultados, adiciona gen√©ricos
                if (todosProdutos.length < 6 && termo) {
                    todosProdutos = adicionarGenericos(todosProdutos, termo, lojas);
                }
                
                renderizarProdutos(todosProdutos);
                
                estaBuscando = false;
                btn.disabled = false;
                btn.textContent = 'Buscar';
                
            }, 100);
        }
        
        function adicionarGenericos(produtos, termo, lojas) {
            const emojis = {
                'celular': 'üì±', 'iphone': 'üì±', 'samsung': 'üì±', 'xiaomi': 'üì±', 'phone': 'üì±',
                'notebook': 'üíª', 'laptop': 'üíª', 'computador': 'üñ•Ô∏è', 'pc': 'üñ•Ô∏è', 'monitor': 'üñ•Ô∏è',
                'tv': 'üì∫', 'televisao': 'üì∫', 'smart tv': 'üì∫', 'tela': 'üì∫',
                'tablet': 'üì≤', 'ipad': 'üì≤',
                'relogio': '‚åö', 'smartwatch': '‚åö', 'watch': '‚åö',
                'camera': 'üì∑', 'foto': 'üì∑', 'webcam': 'üìπ',
                'videogame': 'üéÆ', 'playstation': 'üéÆ', 'xbox': 'üéÆ', 'nintendo': 'üéÆ', 'game': 'üéÆ',
                'fone': 'üéß', 'headphone': 'üéß', 'earphone': 'üéß', 'audio': 'üîä',
                'casa': 'üè†', 'cozinha': 'üç≥', 'eletro': 'üîå', 'geladeira': '‚ùÑÔ∏è', 'fogao': 'üî•',
                'livro': 'üìö', 'kindle': 'üìö', 'leitura': 'üìñ',
                'default': 'üì¶'
            };
            
            let emoji = emojis['default'];
            for (const [key, val] of Object.entries(emojis)) {
                if (termo.includes(key)) {
                    emoji = val;
                    break;
                }
            }
            
            // Adiciona produtos gen√©ricos para completar
            let idBase = 900;
            lojas.forEach(loja => {
                for (let i = 0; i < 3; i++) {
                    const precoBase = 50 + Math.random() * 500;
                    produtos.push({
                        id: `gen${idBase++}`,
                        title: `${termo.toUpperCase()} - Oferta ${i + 1} (${loja.toUpperCase()})`,
                        price: Math.round(precoBase * 0.7 * 100) / 100,
                        original_price: Math.round(precoBase * 100) / 100,
                        imagem: `https://source.unsplash.com/400x300/?${encodeURIComponent(termo)},product,${i}`,
                        emoji: emoji,
                        loja: loja,
                        seller: `${loja.toUpperCase()} Oficial`,
                        rating: 4.0 + Math.random() * 0.9,
                        reviews: Math.floor(100 + Math.random() * 5000),
                        frete: Math.random() > 0.3,
                        tags: [termo, 'oferta', 'promocao'],
                        trustScore: Math.floor(60 + Math.random() * 25)
                    });
                }
            });
            
            return produtos;
        }
        
        function renderizarProdutos(produtos) {
            const resultado = document.getElementById('resultado');
            
            if (produtos.length === 0) {
                resultado.innerHTML = `
                    <div class="loading">
                        <p>üòï Nenhum produto encontrado</p>
                        <p style="font-size: 14px; margin-top: 10px;">Tente: fone, celular, tv, notebook, kindle...</p>
                    </div>
                `;
                return;
            }
            
            resultado.innerHTML = `
                <h2 style="margin-bottom: 20px; color: #333;">üèÜ ${produtos.length} produtos das melhores lojas</h2>
                <div class="grid">
                    ${produtos.map(p => {
                        const desconto = calcularDesconto(p.original_price, p.price);
                        const precoOriginal = desconto > 0 
                            ? `<div class="price-original">${formatarPreco(p.original_price)}</div>` 
                            : '';
                        const badgeDesconto = desconto > 0 
                            ? `<span class="desconto-badge">-${desconto}%</span>` 
                            : '';
                        
                        const frete = p.frete ? 'üöö Frete Gr√°tis' : 'Frete a calcular';
                        
                        const lojaClass = {
                            'ml': 'loja-ml',
                            'shopee': 'loja-shopee',
                            'amazon': 'loja-amazon',
                            'magalu': 'loja-magalu'
                        }[p.loja] || 'loja-ml';
                        
                        const lojaNome = {
                            'ml': 'Mercado Livre',
                            'shopee': 'Shopee',
                            'amazon': 'Amazon',
                            'magalu': 'Magalu'
                        }[p.loja] || p.loja;
                        
                        return `
                            <div class="card" onclick="abrirModal('${p.id}')">
                                <span class="loja-badge ${lojaClass}">${lojaNome}</span>
                                <div class="img-container">
                                    <span class="emoji-fallback">${p.emoji}</span>
                                    <img src="${p.imagem}" 
                                         alt="${p.title}"
                                         loading="lazy"
                                         onerror="this.style.display='none'">
                                </div>
                                <div class="card-body">
                                    <div class="seller">${p.seller}</div>
                                    <div class="card-title">${p.title}</div>
                                    ${badgeDesconto}
                                    ${precoOriginal}
                                    <div class="price">${formatarPreco(p.price)}</div>
                                    
                                    <div class="rating">
                                        <span class="stars">${'‚òÖ'.repeat(Math.round(p.rating))}${'‚òÜ'.repeat(5 - Math.round(p.rating))}</span>
                                        <span>(${p.reviews.toLocaleString()})</span>
                                    </div>
                                    
                                    <div class="trust-badge ${getTrustClass(p.trustScore)}">
                                        <span>üõ°Ô∏è √çndice Acha√≠</span>
                                        <span><strong>${p.trustScore}%</strong></span>
                                    </div>
                                    
                                    <div style="font-size: 11px; color: #666; margin-bottom: 10px;">${frete}</div>
                                    
                                    <a href="#" class="btn-comprar" onclick="event.stopPropagation(); event.preventDefault(); abrirModal('${p.id}')">
                                        Ver Detalhes üîç
                                    </a>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            window.produtosCache = produtos.reduce((acc, p) => {
                acc[p.id] = p;
                return acc;
            }, {});
        }
        
        function abrirModal(id) {
            const p = window.produtosCache[id];
            if (!p) return;
            
            const lojaClass = {
                'ml': 'ml',
                'shopee': 'shopee',
                'amazon': 'amazon',
                'magalu': 'magalu'
            }[p.loja] || 'ml';
            
            const lojaNome = {
                'ml': 'Mercado Livre',
                'shopee': 'Shopee',
                'amazon': 'Amazon',
                'magalu': 'Magazine Luiza'
            }[p.loja];
            
            const lojaCor = {
                'ml': '#ffe600',
                'shopee': '#ee4d2d',
                'amazon': '#ff9900',
                'magalu': '#0086ff'
            }[p.loja];
            
            const desconto = calcularDesconto(p.original_price, p.price);
            
            document.getElementById('modalEmoji').textContent = p.emoji;
            const img = document.getElementById('modalImg');
            img.src = p.imagem;
            img.style.display = 'block';
            img.onload = () => { img.style.zIndex = '2'; };
            img.onerror = () => { img.style.display = 'none'; };
            
            const freteClass = p.frete ? 'free' : 'paid';
            const freteTexto = p.frete ? '‚úÖ Frete Gr√°tis' : '‚ö†Ô∏è Frete: Consultar';
            
            document.getElementById('modalBody').innerHTML = `
                <div class="modal-title">${p.title}</div>
                
                <div class="loja-info ${lojaClass}" style="border-left: 4px solid ${lojaCor};">
                    <strong>üè™ ${lojaNome}</strong>
                    <span style="margin-left: auto; font-size: 12px;">Vendedor: ${p.seller}</span>
                </div>
                
                ${desconto > 0 ? `<div class="desconto-badge" style="margin-bottom: 10px;">üî• ${desconto}% OFF</div>` : ''}
                
                <div class="price" style="font-size: 32px; margin-bottom: 5px;">${formatarPreco(p.price)}</div>
                ${p.original_price ? `<div class="price-original" style="font-size: 16px;">De ${formatarPreco(p.original_price)}</div>` : ''}
                
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">${p.trustScore}%</div>
                        <div class="stat-label">Confian√ßa</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${p.rating.toFixed(1)}</div>
                        <div class="stat-label">Nota ‚≠ê</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${p.reviews.toLocaleString()}</div>
                        <div class="stat-label">Avalia√ß√µes</div>
                    </div>
                </div>
                
                <div class="shipping ${freteClass}">
                    <span style="font-size: 20px;">${p.frete ? 'üöö' : 'üì¶'}</span>
                    <div>
                        <strong>${freteTexto}</strong>
                    </div>
                </div>
                
                <div class="analysis-box">
                    <h4>ü§ñ An√°lise Inteligente Acha√≠</h4>
                    <p>${gerarAnalise(p)}</p>
                </div>
                
                <a href="https://www.${p.loja === 'ml' ? 'mercadolivre' : p.loja === 'magalu' ? 'magazineluiza' : p.loja}.com.br" 
                   target="_blank"
                   class="btn-comprar" 
                   style="font-size: 16px; padding: 16px; background: ${lojaCor}; color: ${p.loja === 'ml' ? '#333' : 'white'};">
                   üõí COMPRAR NA ${lojaNome.toUpperCase()}
                </a>
            `;
            
            document.getElementById('modal').style.display = 'flex';
        }
        
        function gerarAnalise(p) {
            const partes = [];
            
            if (p.trustScore >= 85) {
                partes.push('‚úÖ <strong>Excelente escolha!</strong> Produto muito bem avaliado.');
            } else if (p.trustScore >= 70) {
                partes.push('üëç <strong>Boa op√ß√£o</strong> com boa reputa√ß√£o entre compradores.');
            } else {
                partes.push('‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Pesquise mais antes de comprar.');
            }
            
            if (p.reviews > 10000) {
                partes.push('Mais de 10 mil avalia√ß√µes reais.');
            } else if (p.reviews > 1000) {
                partes.push('Milhares de compradores aprovaram.');
            }
            
            if (p.frete) {
                partes.push('Frete gr√°tis √© um grande diferencial!');
            }
            
            if (p.original_price && p.price < p.original_price * 0.75) {
                partes.push('üî• <strong>Super promo√ß√£o!</strong> Pre√ßo muito abaixo do normal.');
            }
            
            return partes.join(' ');
        }
        
        function fecharModal(event) {
            if (!event || event.target.id === 'modal') {
                document.getElementById('modal').style.display = 'none';
            }
        }
        
        // Inicia automaticamente
        document.addEventListener('DOMContentLoaded', buscar);
        
        // Enter para buscar
        document.getElementById('searchInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') buscar();
        });
    </script>
</body>
</html>
